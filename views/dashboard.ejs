<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>StockMaster | Dashboard</title>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    
    <link href="https://cdn.prod.website-files.com/67a323a1c68594827fa0cca9/css/soscale-39349c-c66c87b5666753b1b89d5bc1.webflow.shared.1aa2f82cd.css" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous"/>
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({ google: { families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Oswald:200,300,400,500,600,700"] }});</script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js" defer ></script>

    <style>
        /* Dashboard Specific CSS */
        .dashboard-section { padding-top: 120px; padding-bottom: 60px; min-height: 100vh; background-color: #0e0e0e; color: white; }
        .dashboard-grid { display: grid; grid-template-columns: 250px 1fr; gap: 40px; max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        
        /* Sidebar */
        .sidebar-menu { border-right: 1px solid rgba(255,255,255,0.1); padding-right: 20px; }
        .sidebar-item { display: block; padding: 15px 0; color: #888; text-decoration: none; font-family: 'Oswald', sans-serif; text-transform: uppercase; font-size: 16px; transition: color 0.3s; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .sidebar-item:hover, .sidebar-item.active { color: #fff; }
        
        /* KPIs */
        .kpi-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 60px; }
        .kpi-card { background: #1a1a1a; padding: 30px; border: 1px solid rgba(255,255,255,0.1); position: relative; overflow: hidden; transition: transform 0.3s ease; }
        .kpi-card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.3); }
        .kpi-value { font-family: 'Oswald', sans-serif; font-size: 40px; margin-bottom: 10px; color: #fff; }
        .kpi-label { font-family: 'Montserrat', sans-serif; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #888; }
        
        .section-header { font-family: 'Oswald', sans-serif; font-size: 24px; margin-bottom: 30px; text-transform: uppercase; }
        .action-button { display: inline-block; padding: 10px 20px; background: white; color: black; text-transform: uppercase; font-family: 'Oswald', sans-serif; font-size: 14px; text-decoration: none; margin-top: 20px; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 10px; text-transform: uppercase; font-weight: bold; }
        
        .w-webflow-badge { display: none !important; } 
    </style>
</head>

<body class="body">

    <nav class="hero-wrap">
        <a href="/" class="header-text-left _1 fixed-right-mob w-inline-block"><div class="letter-wrap black">STOCKMASTER</div></a>

        <div class="header-text-left fixed-left">
            <div class="header-text-left fix-size">
                <a href="/home" aria-current="page" class="menu-link-block w-inline-block w--current"><div class="letter-wrap">Dashboard</div></a>
                <a href="/products" class="menu-link-block w-inline-block"><div class="letter-wrap">Products</div></a>
                <a href="/operations" class="menu-link-block w-inline-block"><div class="letter-wrap">Operations</div></a>
            </div>
        </div>

        <div class="header-text-left fixed-center"><div class="hacker-text _1">Overview & KPIs</div></div>

        <a href="/users/logout" class="header-text-left _1 fixed-right w-inline-block">
            <img loading="eager" src="https://cdn.prod.website-files.com/67a323a1c68594827fa0cca9/67a323a1c68594827fa0ccb4_Vector.svg" alt="" class="arrow-black"/>
            <div class="letter-wrap black">LOGOUT</div>
        </a>
    </nav>

    <section class="dashboard-section">
        <div class="dashboard-grid">
            
            <aside class="sidebar-menu">
    <div style="margin-bottom: 40px;">
        <h3 class="kpi-label" style="color: white; margin-bottom: 20px;">Profile Menu</h3>
        <div class="sidebar-item" style="color: #fff;">Welcome, <%= typeof user !== 'undefined' ? user.fullname : 'User' %></div>
        <a href="/profile" class="sidebar-item">My Profile</a>
        <a href="/users/logout" class="sidebar-item">Logout</a>
    </div>

    <h3 class="kpi-label" style="color: white; margin-bottom: 20px;">Quick Actions</h3>
    <a href="/operations" class="sidebar-item">Incoming Receipts</a>
    <a href="/operations" class="sidebar-item">Delivery Orders</a>
    <a href="/products" class="sidebar-item">Check Stock</a>
    
    <a href="/warehouses/map" class="sidebar-item" style="color: #4dff88; border-color: #4dff88;">üìç Manage Warehouses</a>
</aside>

            <div class="main-content">
                
                <h2 class="section-header">Overview</h2>
                <div class="kpi-container">
                    <div class="kpi-card">
                        <div class="kpi-value"><%= totalProducts %></div>
                        <div class="kpi-label">Total Products (SKUs)</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" style="color: <%= lowStockCount > 0 ? '#ff4d4d' : '#4dff88' %>;">
                            <%= lowStockCount %>
                        </div>
                        <div class="kpi-label">Low Stock Items</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value"><%= pendingReceipts %></div>
                        <div class="kpi-label">Pending Receipts</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value"><%= pendingDeliveries %></div>
                        <div class="kpi-label">Pending Deliveries</div>
                    </div>
                </div>

                <h2 class="section-header">Recent Activity</h2>
                
                <div class="kpi-card" style="padding: 0;">
                    <% if (recentOps && recentOps.length > 0) { %>
                        <% recentOps.forEach(function(op) { %>
                            <div style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-family: 'Oswald'; font-size: 14px; color: white;">
                                        <%= op.reference %> 
                                        <span style="color: #888; font-size: 12px; margin-left: 10px;">
                                            (<%= new Date(op.createdAt).toLocaleDateString() %>)
                                        </span>
                                    </div>
                                    <div style="font-family: 'Montserrat'; font-size: 12px; color: #666; margin-top: 4px;">
                                        <%= op.type %>: 
                                        <% if (op.items && op.items.length > 0 && op.items[0].product) { %>
                                            <%= op.items[0].quantity %>x <%= op.items[0].product.name %>
                                        <% } else { %>
                                            (Item removed)
                                        <% } %>
                                    </div>
                                </div>
                                <span class="status-badge" style="
                                    background: <%= op.status === 'Done' ? 'rgba(77, 255, 136, 0.1)' : 'rgba(255, 170, 77, 0.1)' %>; 
                                    color: <%= op.status === 'Done' ? '#4dff88' : '#ffaa4d' %>;">
                                    <%= op.status %>
                                </span>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div style="padding: 30px; text-align: center; color: #666; font-family: 'Montserrat';">
                            No recent operations found. Start by creating a receipt!
                        </div>
                    <% } %>
                </div>

                <a href="/operations" class="action-button">View Full History</a>

            </div>
        </div>
    </section>

    <section class="footer">
        <div class="footer-wrapper-top">
            <div class="footer-divider"></div>
            <div class="div-block-75">
                <div class="text-block-7">StockMaster IMS v1.0</div>
                <a href="#" class="text-block-7-copy">¬© 2025 StockMaster</a>
            </div>
        </div>
    </section>

    <script>
    // Text Animation (Reused from Home)
    const letterWrapClass = 'letter-wrap';
    const letterWrapElements = document.getElementsByClassName(letterWrapClass);
    [...letterWrapElements].forEach(el => {
      letterWrap(el, letterWrapClass);
      letterAnimation(el, letterWrapClass);
    });
    function letterWrap(el, cls) {
      const words = el.textContent.split(' ');
      const letters = [];
      cls = cls || 'letter-wrap'
      words.forEach(word => {
        let html = '';
        for (var letter in word) {
          html += `<span class="${cls}__char"><span class="${cls}__char-inner" data-letter="${word[letter]}">${word[letter]}</span></span>`;
        };
        let wrappedWords = `<span class="${cls}__word">${html}</span>`;
        letters.push(wrappedWords);
      });
      return el.innerHTML = letters.join(' ');
    }
    function letterAnimation(el, cls) {
      const tl = new TimelineMax({ paused: true });
      const characters = el.querySelectorAll(`.${cls}__char-inner`);
      const duration = el.hasAttribute('data-duration') ? el.dataset.duration : 0.3;
      const stagger = el.hasAttribute('data-stagger') ? el.dataset.stagger : 0.025;
      el.animation = tl.staggerTo(characters, duration, { y: '-100%', delay: 0.05, ease: Power2.easeOut, }, stagger);
      el.addEventListener('mouseenter', (event) => event.currentTarget.animation.play());
      el.addEventListener('mouseout', (event) => el.animation.pause(0)());
    }
    </script>
</body>
</html>